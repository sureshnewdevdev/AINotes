<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ü§ñ Gen AI with Python ‚Äî Web Demo</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .card { @apply bg-white rounded-2xl shadow p-5 border border-gray-100; }
    .btn { @apply px-4 py-2 rounded-xl font-medium shadow; }
    .btn-primary { @apply bg-indigo-600 text-white hover:bg-indigo-700; }
    .btn-ghost { @apply bg-gray-100 hover:bg-gray-200; }
    .tab-active { @apply bg-indigo-50 text-indigo-700 border-indigo-200; }
    .spinner { border: 3px solid #eee; border-top: 3px solid #6366f1; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; display:inline-block }
    @keyframes spin { 100% { transform: rotate(360deg); } }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    .hide { display: none; }
    .img-box { max-height: 512px; overflow: auto; }
    .demo-badge { @apply inline-block bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full; }
  </style>
</head>
<body class="bg-gray-50 text-gray-800">
  <header class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 pt-8">
    <h1 class="text-2xl sm:text-3xl font-bold">ü§ñ Gen AI Demo Hub</h1>
    <p class="text-sm text-gray-600">One HTML page for Story, Poem, Chatbot, Text‚ÜíImage, and Image‚ÜíCaption using <strong>100% Free Models</strong>.</p>
    <div id="demoModeIndicator" class="mt-2 hide">
      <span class="demo-badge">üé≠ Demo Mode Active - Using Offline Fallbacks</span>
    </div>
  </header>

  <div id="twWarn" class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 mt-4">
    <div class="rounded-xl bg-yellow-50 border border-yellow-200 p-3 text-sm text-yellow-900">
      ‚ö†Ô∏è Tailwind via CDN is fine for demos but not for production. For production, install Tailwind via CLI/PostCSS.
      <button id="hideTwWarn" class="ml-2 underline">Hide</button>
    </div>
  </div>

  <section class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 mt-6">
    <div class="card">
      <label class="block text-sm font-medium mb-1">Hugging Face API Token (Optional - Demo works without it)</label>
      <input id="hfToken" type="password" class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm" 
             placeholder="hf_... (Leave empty to use demo mode)" />
      <p class="text-xs text-gray-500 mt-1">
        Get your free token at <a href="https://huggingface.co/settings/tokens" target="_blank" class="text-indigo-600 underline">huggingface.co/settings/tokens</a>
        or leave empty to use offline demo mode.
      </p>
      
      <div class="mt-4">
        <label class="flex items-center">
          <input type="checkbox" id="forceDemo" class="mr-2" />
          <span class="text-sm">Force Demo Mode (use offline responses even with API token)</span>
        </label>
      </div>
    </div>
  </section>

  <section class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 mt-6">
    <div class="card">
      <div class="flex flex-wrap gap-2 mb-4">
        <button id="tabStory" class="btn btn-ghost tab-active">üìñ Story</button>
        <button id="tabPoem" class="btn btn-ghost">üé≠ Poem</button>
        <button id="tabChat" class="btn btn-ghost">üí¨ Chatbot</button>
        <button id="tabT2I" class="btn btn-ghost">üé® Text‚ÜíImage</button>
        <button id="tabI2C" class="btn btn-ghost">üñºÔ∏è Image‚ÜíCaption</button>
      </div>

      <!-- Story Tab -->
      <div id="contentStory" class="tab-content">
        <h3 class="text-lg font-semibold mb-3">üìñ Story Generator</h3>
        <p class="text-sm text-gray-600 mb-3">Using: <code class="mono bg-gray-100 px-1 rounded">microsoft/DialoGPT-medium</code> (Free alternative to FLAN-T5)</p>
        <textarea id="storyPrompt" class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm mb-3" rows="3" 
                  placeholder="Write a story about a brave knight..."></textarea>
        <button id="genStory" class="btn btn-primary">Generate Story</button>
        <div id="storyResult" class="mt-4 p-3 bg-gray-50 rounded-lg text-sm hide"></div>
      </div>

      <!-- Poem Tab -->
      <div id="contentPoem" class="tab-content hide">
        <h3 class="text-lg font-semibold mb-3">üé≠ Poem Generator</h3>
        <p class="text-sm text-gray-600 mb-3">Using: <code class="mono bg-gray-100 px-1 rounded">microsoft/DialoGPT-medium</code> (Free alternative to FLAN-T5)</p>
        <textarea id="poemPrompt" class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm mb-3" rows="3" 
                  placeholder="Write a poem about the ocean..."></textarea>
        <button id="genPoem" class="btn btn-primary">Generate Poem</button>
        <div id="poemResult" class="mt-4 p-3 bg-gray-50 rounded-lg text-sm hide"></div>
      </div>

      <!-- Chat Tab -->
      <div id="contentChat" class="tab-content hide">
        <h3 class="text-lg font-semibold mb-3">üí¨ Chatbot</h3>
        <p class="text-sm text-gray-600 mb-3">Using: <code class="mono bg-gray-100 px-1 rounded">microsoft/DialoGPT-medium</code> (100% Free)</p>
        <div id="chatHistory" class="bg-gray-50 rounded-lg p-3 mb-3 h-64 overflow-y-auto text-sm"></div>
        <div class="flex gap-2">
          <input id="chatInput" type="text" class="flex-1 rounded-lg border border-gray-300 px-3 py-2 text-sm" 
                 placeholder="Type your message..." />
          <button id="sendChat" class="btn btn-primary">Send</button>
          <button id="clearChat" class="btn btn-ghost">Clear</button>
        </div>
      </div>

      <!-- Text-to-Image Tab -->
      <div id="contentT2I" class="tab-content hide">
        <h3 class="text-lg font-semibold mb-3">üé® Text-to-Image</h3>
        <p class="text-sm text-gray-600 mb-3">Using: <code class="mono bg-gray-100 px-1 rounded">Pollinations.AI API</code> (No API key required) + <code class="mono bg-gray-100 px-1 rounded">stabilityai/stable-diffusion-2-1</code> fallback</p>
        <textarea id="t2iPrompt" class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm mb-3" rows="3" 
                  placeholder="A beautiful sunset over mountains..."></textarea>
        <button id="genImage" class="btn btn-primary">Generate Image</button>
        <div id="imageResult" class="mt-4 hide">
          <div class="img-box">
            <img id="generatedImage" class="w-full rounded-lg" alt="Generated image" />
          </div>
        </div>
      </div>

      <!-- Image-to-Caption Tab -->
      <div id="contentI2C" class="tab-content hide">
        <h3 class="text-lg font-semibold mb-3">üñºÔ∏è Image-to-Caption</h3>
        <p class="text-sm text-gray-600 mb-3">Using: <code class="mono bg-gray-100 px-1 rounded">Salesforce/blip-image-captioning-base</code> (Free alternative to ViT-GPT2)</p>
        <input id="imageUpload" type="file" accept="image/*" class="w-full rounded-lg border border-gray-300 px-3 py-2 text-sm mb-3" />
        <button id="genCaption" class="btn btn-primary">Generate Caption</button>
        <div id="captionResult" class="mt-4 hide">
          <div class="img-box mb-3">
            <img id="uploadedImage" class="w-full rounded-lg" alt="Uploaded image" />
          </div>
          <div id="captionText" class="p-3 bg-gray-50 rounded-lg text-sm"></div>
        </div>
      </div>
    </div>
  </section>

  <footer class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8 text-center text-xs text-gray-500">
    <p>ü§ñ Gen AI Demo Hub - Using 100% Free Models | Built with ‚ù§Ô∏è and Open Source</p>
    <p class="mt-1">Models: DialoGPT-medium, BLIP, Stable Diffusion 2.1, Pollinations.AI</p>
  </footer>

  <script>
    // Configuration for free models
    const CONFIG = {
      models: {
        text: 'microsoft/DialoGPT-medium',  // Free alternative to FLAN-T5
        chat: 'microsoft/DialoGPT-medium',  // Free chatbot model
        imageCaption: 'Salesforce/blip-image-captioning-base',  // Free alternative to ViT-GPT2
        textToImage: 'stabilityai/stable-diffusion-2-1'  // Free alternative to SD 1.5
      },
      pollinations: {
        baseUrl: 'https://image.pollinations.ai/prompt/',  // No API key required
        fallback: true
      },
      demoMode: {
        enabled: false,
        responses: {
          story: "Once upon a time, in a land far away, there lived a brave knight named Sir Galahad. He embarked on a quest to find the legendary Crystal of Wisdom, facing many challenges along the way. Through courage and determination, he discovered that the real treasure was the friends he made during his journey. The end.",
          poem: "Beneath the starlit sky so bright,\nThe ocean waves dance in moonlight.\nWhispers of the gentle breeze,\nCarry secrets through the trees.\n\nNature's symphony plays on,\nFrom dusk until the break of dawn.\nIn this moment, peace we find,\nCalming both the heart and mind.",
          chat: "Hello! I'm your AI assistant. I'm here to help you with any questions or just have a friendly conversation. What would you like to talk about today?",
          imageCaption: "A beautiful landscape with mountains in the background and a serene lake in the foreground, captured during golden hour with warm, soft lighting."
        }
      }
    };

    // Global state
    let chatHistory = [];
    let isDemoMode = false;

    // Utility functions
    function getToken() {
      return document.getElementById('hfToken').value.trim();
    }

    function shouldUseDemo() {
      return document.getElementById('forceDemo').checked || !getToken() || isDemoMode;
    }

    function showDemoIndicator(show = true) {
      const indicator = document.getElementById('demoModeIndicator');
      if (show) {
        indicator.classList.remove('hide');
        isDemoMode = true;
      } else {
        indicator.classList.add('hide');
        isDemoMode = false;
      }
    }

    function showSpinner(buttonId) {
      const btn = document.getElementById(buttonId);
      btn.innerHTML = '<span class="spinner"></span> Generating...';
      btn.disabled = true;
    }

    function hideSpinner(buttonId, originalText) {
      const btn = document.getElementById(buttonId);
      btn.innerHTML = originalText;
      btn.disabled = false;
    }

    function showResult(resultId, content) {
      const result = document.getElementById(resultId);
      result.innerHTML = content;
      result.classList.remove('hide');
    }

    // API call with fallback to demo mode
    async function callHuggingFaceAPI(model, payload) {
      if (shouldUseDemo()) {
        showDemoIndicator();
        throw new Error('Demo mode active');
      }

      const token = getToken();
      const response = await fetch(`https://api-inference.huggingface.co/models/${model}`, {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(payload)
      });

      if (!response.ok) {
        showDemoIndicator();
        throw new Error(`API call failed: ${response.status}`);
      }

      return response;
    }

    // Text generation (Stories & Poems)
    async function generateText(prompt, type) {
      const buttonId = type === 'story' ? 'genStory' : 'genPoem';
      const resultId = type === 'story' ? 'storyResult' : 'poemResult';
      const originalText = type === 'story' ? 'Generate Story' : 'Generate Poem';

      showSpinner(buttonId);

      try {
        const response = await callHuggingFaceAPI(CONFIG.models.text, {
          inputs: prompt,
          parameters: {
            max_length: type === 'story' ? 200 : 100,
            temperature: 0.8,
            do_sample: true
          }
        });

        const data = await response.json();
        let result = data[0]?.generated_text || data.generated_text || 'No result generated.';
        
        // Clean up the result
        if (result.startsWith(prompt)) {
          result = result.substring(prompt.length).trim();
        }

        showResult(resultId, `<strong>${type.charAt(0).toUpperCase() + type.slice(1)}:</strong><br><br>${result}`);
      } catch (error) {
        console.log('Using demo mode fallback:', error.message);
        showDemoIndicator();
        const demoResponse = CONFIG.demoMode.responses[type];
        showResult(resultId, `<strong>${type.charAt(0).toUpperCase() + type.slice(1)} (Demo):</strong><br><br>${demoResponse}`);
      }

      hideSpinner(buttonId, originalText);
    }

    // Chatbot
    async function sendChatMessage() {
      const input = document.getElementById('chatInput');
      const message = input.value.trim();
      if (!message) return;

      // Add user message to history
      chatHistory.push({ role: 'user', content: message });
      updateChatDisplay();
      input.value = '';

      showSpinner('sendChat');

      try {
        const response = await callHuggingFaceAPI(CONFIG.models.chat, {
          inputs: {
            past_user_inputs: chatHistory.filter(m => m.role === 'user').map(m => m.content),
            generated_responses: chatHistory.filter(m => m.role === 'assistant').map(m => m.content),
            text: message
          }
        });

        const data = await response.json();
        const botResponse = data.generated_text || data.response || 'I apologize, but I cannot generate a response right now.';

        chatHistory.push({ role: 'assistant', content: botResponse });
        updateChatDisplay();
      } catch (error) {
        console.log('Using demo mode fallback:', error.message);
        showDemoIndicator();
        const demoResponse = CONFIG.demoMode.responses.chat;
        chatHistory.push({ role: 'assistant', content: `${demoResponse} (Demo mode active)` });
        updateChatDisplay();
      }

      hideSpinner('sendChat', 'Send');
    }

    function updateChatDisplay() {
      const chatDiv = document.getElementById('chatHistory');
      chatDiv.innerHTML = chatHistory.map(msg => 
        `<div class="mb-2 ${msg.role === 'user' ? 'text-right' : 'text-left'}">
          <span class="inline-block px-3 py-2 rounded-lg ${msg.role === 'user' ? 'bg-indigo-600 text-white' : 'bg-white border'} max-w-xs">
            ${msg.content}
          </span>
        </div>`
      ).join('');
      chatDiv.scrollTop = chatDiv.scrollHeight;
    }

    // Text-to-Image with Pollinations.AI (no API key) + HF fallback
    async function generateImage() {
      const prompt = document.getElementById('t2iPrompt').value.trim();
      if (!prompt) return;

      showSpinner('genImage');

      try {
        // Try Pollinations.AI first (no API key required)
        const pollinationsUrl = `${CONFIG.pollinations.baseUrl}${encodeURIComponent(prompt)}?width=512&height=512&seed=${Math.floor(Math.random() * 1000000)}`;
        
        // Test if the image loads
        const img = new Image();
        img.onload = function() {
          document.getElementById('generatedImage').src = pollinationsUrl;
          document.getElementById('imageResult').classList.remove('hide');
          hideSpinner('genImage', 'Generate Image');
        };
        img.onerror = async function() {
          // Fallback to Hugging Face if Pollinations fails
          try {
            if (shouldUseDemo()) throw new Error('Demo mode');
            
            const response = await callHuggingFaceAPI(CONFIG.models.textToImage, {
              inputs: prompt
            });

            const blob = await response.blob();
            const imageUrl = URL.createObjectURL(blob);
            document.getElementById('generatedImage').src = imageUrl;
            document.getElementById('imageResult').classList.remove('hide');
          } catch (hfError) {
            console.log('Using demo mode fallback:', hfError.message);
            showDemoIndicator();
            // Use a placeholder image for demo
            document.getElementById('generatedImage').src = `https://via.placeholder.com/512x512/6366f1/ffffff?text=${encodeURIComponent('Demo Image: ' + prompt.substring(0, 20) + '...')}`;
            document.getElementById('imageResult').classList.remove('hide');
          }
          hideSpinner('genImage', 'Generate Image');
        };
        img.src = pollinationsUrl;
      } catch (error) {
        console.log('Image generation error:', error.message);
        hideSpinner('genImage', 'Generate Image');
      }
    }

    // Image-to-Caption
    async function generateCaption() {
      const fileInput = document.getElementById('imageUpload');
      const file = fileInput.files[0];
      if (!file) return;

      showSpinner('genCaption');

      // Display uploaded image
      const reader = new FileReader();
      reader.onload = function(e) {
        document.getElementById('uploadedImage').src = e.target.result;
      };
      reader.readAsDataURL(file);

      try {
        const response = await callHuggingFaceAPI(CONFIG.models.imageCaption, {
          inputs: await fileToBase64(file)
        });

        const data = await response.json();
        const caption = data[0]?.generated_text || data.caption || 'Unable to generate caption.';

        document.getElementById('captionText').innerHTML = `<strong>Caption:</strong><br>${caption}`;
        document.getElementById('captionResult').classList.remove('hide');
      } catch (error) {
        console.log('Using demo mode fallback:', error.message);
        showDemoIndicator();
        const demoCaption = CONFIG.demoMode.responses.imageCaption;
        document.getElementById('captionText').innerHTML = `<strong>Caption (Demo):</strong><br>${demoCaption}`;
        document.getElementById('captionResult').classList.remove('hide');
      }

      hideSpinner('genCaption', 'Generate Caption');
    }

    function fileToBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result.split(',')[1]);
        reader.onerror = error => reject(error);
      });
    }

    // Tab switching
    function switchTab(tabName) {
      // Hide all content
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.add('hide');
      });
      
      // Remove active class from all tabs
      document.querySelectorAll('[id^="tab"]').forEach(tab => {
        tab.classList.remove('tab-active');
      });
      
      // Show selected content and activate tab
      document.getElementById(`content${tabName}`).classList.remove('hide');
      document.getElementById(`tab${tabName}`).classList.add('tab-active');
    }

    // Event listeners
    document.addEventListener('DOMContentLoaded', function() {
      // Tab switching
      document.getElementById('tabStory').addEventListener('click', () => switchTab('Story'));
      document.getElementById('tabPoem').addEventListener('click', () => switchTab('Poem'));
      document.getElementById('tabChat').addEventListener('click', () => switchTab('Chat'));
      document.getElementById('tabT2I').addEventListener('click', () => switchTab('T2I'));
      document.getElementById('tabI2C').addEventListener('click', () => switchTab('I2C'));

      // Feature buttons
      document.getElementById('genStory').addEventListener('click', () => {
        const prompt = document.getElementById('storyPrompt').value.trim();
        if (prompt) generateText(prompt, 'story');
      });

      document.getElementById('genPoem').addEventListener('click', () => {
        const prompt = document.getElementById('poemPrompt').value.trim();
        if (prompt) generateText(prompt, 'poem');
      });

      document.getElementById('sendChat').addEventListener('click', sendChatMessage);
      document.getElementById('chatInput').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') sendChatMessage();
      });

      document.getElementById('clearChat').addEventListener('click', () => {
        chatHistory = [];
        updateChatDisplay();
      });

      document.getElementById('genImage').addEventListener('click', generateImage);
      document.getElementById('genCaption').addEventListener('click', generateCaption);

      // Hide warning
      document.getElementById('hideTwWarn').addEventListener('click', () => {
        document.getElementById('twWarn').classList.add('hide');
      });

      // Demo mode toggle
      document.getElementById('forceDemo').addEventListener('change', (e) => {
        if (e.target.checked) {
          showDemoIndicator();
        } else if (getToken()) {
          showDemoIndicator(false);
        }
      });

      // Initialize chat
      updateChatDisplay();
    });
  </script>
</body>
</html>
